"use strict";var _createClass=(function(){function a(e,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||false;d.configurable=true;if("value" in d){d.writable=true}Object.defineProperty(e,d.key,d)}}return function(d,b,c){if(b){a(d.prototype,b)}if(c){a(d,c)}return d}})();function _typeof(a){return a&&typeof Symbol!=="undefined"&&a.constructor===Symbol?"symbol":typeof a}function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var KeepConditions=(function(){function e(u){_classCallCheck(this,e);if(!$.fn.DataTable.isDataTable(u)&&!u instanceof $.fn.dataTable.Api){throw new Error("Failed to initialize KeepConditions on non-datatable object")}if(u instanceof $.fn.dataTable.Api){this._dtApi=u}else{this._dtApi=new $.fn.dataTable.Api(u)}u=this._dtApi.settings()[0];this._tableId=$(this._dtApi.table().node()).attr("id");this._keysToCons=this._keyMap();this._shouldDraw=false;this._dtSettings=u;this._dtDefaults=$.fn.dataTable.defaults;this._enabledConditions=[];this._eventNamespace="keepConditions";u.oKeepConditions=this;this._init()}_createClass(e,[{key:"_init",value:function k(){this._collectEnabled();if(this._dtSettings.oInit.keepConditions===true||typeof this._dtSettings.oInit.keepConditions==="string"||$.isArray(this._dtSettings.oInit.keepConditions)||$.isPlainObject(this._dtSettings.oInit.keepConditions)&&(typeof this._dtSettings.oInit.keepConditions.attachEvents==="undefined"||this._dtSettings.oInit.keepConditions.attachEvents===true)){this.attachEvents()}this.processHash()}},{key:"_collectEnabled",value:function b(){var u=this;$.each(this.conditions(),function(w,v){if(!u._isEnabled(w)||!v.isInit()){return}u.enableCondition(w)})}},{key:"_keyMap",value:function a(){return(function(v){var u={};$.each(v,function(x,w){u[w.key]=x});return u})(this.conditions())}},{key:"_isEnabled",value:function q(w){var v=this._dtSettings.oInit.keepConditions;if(w.length===1){var u=this.nameByKey(w);if(!w){throw new Error("Unable to find an existing condition with the key '"+w+"'")}w=u}else{if(this.conditions(w)===false){throw new Error("Unable to find an existing condition with the name '"+w+"'")}}return(v===true||typeof v==="undefined"||typeof v==="string"&&v.indexOf(this.conditions(w).key)!==-1||$.isArray(v)&&$.inArray(w,v)!==-1||$.isPlainObject(v)&&$.isArray(v.conditions)&&$.inArray(w,v.conditions)!==-1||$.isPlainObject(v)&&typeof v.conditions==="string"&&v.conditions.indexOf(this.conditions(w).key)!==-1)}},{key:"_drawTable",value:function j(v,u){if(this._shouldDraw===true||v===true){this._dtApi.draw(u===true);this._shouldDraw=false}}},{key:"_lang",value:function m(v,u){}},{key:"structureHash",value:function n(u){return e.structureHash(this._dtSettings,u)}},{key:"dtSettings",value:function c(){return this._dtSettings}},{key:"attachEvents",value:function r(){var u=this;var x={dtSettings:this._dtSettings},w=this.getEnabledConditions();if(w===false){throw new Error("No enabled conditions to attach to events")}var v=this.conditions(w);$.each(v,function(z,y){u._dtApi.on(y.event+"."+u._eventNamespace,x,e.structureHash.bind(e))})}},{key:"detachEvents",value:function l(){var u=this;var x={dtSettings:this._dtSettings},w=this.getEnabledConditions();if(w===false){throw new Error("No enabled conditions to attach to events")}var v=this.conditions(w);$.each(v,function(z,y){if(!u._isEnabled(z)||!y.isInit()){return}u._dtApi.off(y.event+"."+u._eventNamespace)})}},{key:"detachEvent",value:function g(w){if(typeof w==="undefined"){console.warn("No condition or event specified for KeepConditions.detachEvent(), nothing is getting detached");return}var u=this.conditions(w);if(!u){return false}var v;if(typeof w==="string"){if(w.endsWith(".dt")){v=w}else{v=u.event}this._dtApi.off(v,e.structureHash.bind(e))}else{if($.isArray(w)&&w.length>0){$.each(w,function(x,y){if(y.endsWith(".dt")){v=y}else{if(typeof u[y]!=="undefined"){v=u[y].event}else{throw new Error("Unknown condition specified: "+y)}}this._dtApi.off(v+"."+this._eventNamespace)})}else{console.warn("Illegal parameter type for KeepConditions.detachEvent(), should be array or string, was: ",typeof w==="undefined"?"undefined":_typeof(w))}}}},{key:"attachEvent",value:function p(x){if(typeof x==="undefined"){console.warn("No condition or event specified for KeepConditions.attachEvent(), nothing is getting attached");return}var w={dtSettings:this._dtSettings};var u=this.conditions(x);if(!u){return false}var v;if(typeof x==="string"){if(x.endsWith(".dt")){v=x}else{v=u.event}this._dtApi.on(v,w,e.structureHash.bind(e))}else{if($.isArray(x)&&x.length>0){$.each(x,function(y,z){if(z.endsWith(".dt")){v=z}else{if(typeof u[z]!=="undefined"){v=u[z].event}else{throw new Error("Unknown condition specified: "+z)}}this._dtApi.on(v+"."+this._eventNamespace,e.structureHash.bind(e))})}else{console.warn("Illegal parameter type for KeepConditions.attachEvent(), should be array or string, was: "+(typeof x==="undefined"?"undefined":_typeof(x)))}}}},{key:"processHash",value:function h(){var u=this;$.each(e.queryString(),function(w,v){if($.isArray(v)||$.isPlainObject(v)){v=v[0]}if(w!==u._tableId){return}$.each(v.split(":"),function(z,C){var B=C.charAt(0),y=C.substring(1),A=u.nameByKey(B),x=u.conditions()[A];if($.inArray(A,u.getEnabledConditions())===-1){return}if(typeof x==="undefined"){console.warn("[keepConditions:' "+u._tableId+"] No condition object found for condition key:",B);return}x.onLoad(y)});u._drawTable()})}},{key:"enableCondition",value:function d(w,v){var u=false;if($.isArray(w)){$.each(w,function(x,y){if(y.length===1){y=this.nameByKey(y)}if(this.conditions(y)!==false){this._enabledConditions.push(y);u=true}})}else{if(typeof w==="string"){if(w.length===1){w=this.nameByKey(w)}if(this.conditions(w)!==false){this._enabledConditions.push(w);u=true}}}if(v===true&&u===true){e.structureHash(this._dtSettings,false)}}},{key:"disableCondition",value:function s(w,v){var u=false;if($.isArray(w)){$.each(w,function(x,y){if(y.length===1){y=this.nameByKey(y)}if(this.conditions(y)!==false){this._enabledConditions.splice($.inArray(y,this._enabledConditions),1);u=true}})}else{if(typeof w==="string"){if(w.length===1){w=this.nameByKey(w)}if(this.conditions(w)!==false){this._enabledConditions.splice($.inArray(w,this._enabledConditions),1);u=true}}}if(v===true&&u===true){e.structureHash(this._dtSettings,false)}}},{key:"getEnabledConditions",value:function t(){return this._enabledConditions.length>0?$.unique(this._enabledConditions):false}},{key:"nameByKey",value:function o(u){return this._keysToCons[u]||false}},{key:"conditions",value:function i(u){var x=this;var v=this;var B={search:{key:"f",event:"search.dt",isInit:function y(){return typeof v._dtSettings.oInit.searching==="undefined"||v._dtSettings.oInit.searching!==false},onLoad:function A(D){if(typeof D!=="undefined"&&v._dtApi.search()!==decodeURIComponent(D)){v._dtApi.search(decodeURIComponent(D));v._shouldDraw=true}},isset:function z(){return v._dtApi.search().length!==0},newHashVal:function w(){return encodeURIComponent(v._dtApi.search())}},length:{key:"l",event:"length.dt",isInit:function y(){return !(v._dtSettings.oInit.lengthChange===false||typeof v._dtSettings.oInit.lengthChange==="undefined"&&v._dtDefaults.bLengthChange===false)},onLoad:function A(D){if(typeof D!=="undefined"){v._dtApi.page.len(parseInt(D));v._shouldDraw=true}},isset:function z(){return v._dtApi.page.len()&&v._dtApi.page.len()!==(v._dtSettings.oInit.pageLength||v._dtDefaults.iDisplayLength)},newHashVal:function w(){return v._dtApi.page.len()}},page:{key:"p",event:"page.dt",isInit:function y(){return !(v._dtSettings.oInit.paging===false||typeof v._dtSettings.oInit.paging==="undefined"&&v._dtDefaults.bPaginate===false)},onLoad:function A(D){if(typeof D!=="undefined"&&parseInt(D)!==0){v._dtApi.page(parseInt(D));v._shouldDraw=true}},isset:function z(){return v._dtApi.page.info()&&v._dtApi.page.info().page!==0},newHashVal:function w(){return v._dtApi.page.info().page}},colvis:{key:"v",event:"column-visibility.dt",isInit:function y(){return true},onLoad:function A(E){if(typeof E!=="undefined"){var D=(function(){var F=E.charAt(0),G=E.substring(1).split(".");if(F!=="f"&&F!=="t"){console.warn("Unknown ColVis condition visibility value, expected t or f, found:",F);return{v:undefined}}v._dtApi.columns().indexes().each(function(I,H){if(F==="t"){if($.inArray(I.toString(),G)===-1){v._dtApi.column(I).visible(false)}else{v._dtApi.column(I).visible(true)}}else{if($.inArray(I.toString(),G)===-1){v._dtApi.column(I).visible(true)}else{v._dtApi.column(I).visible(false)}}});v._shouldDraw=true})();if((typeof D==="undefined"?"undefined":_typeof(D))==="object"){return D.v}}},isset:function z(){return v._dtApi.columns().visible().filter(function(D){return !D}).any()},newHashVal:function w(){var D=[],E=[];v._dtApi.columns().visible().each(function(G,F){if(G===true){D.push(F)}else{E.push(F)}});if(D.length>=E.length){return"f"+E.join(".")}return"t"+D.join(".")}},scroller:{key:"s",event:"draw.dt",isInit:function y(){return typeof v._dtSettings.oScroller!=="undefined"},onLoad:function A(D){if(parseInt(D)!==0){v._dtApi.row(parseInt(D)).scrollTo()}},isset:function z(){return Math.trunc(parseInt(v._dtSettings.oScroller.s.baseRowTop))!==0},newHashVal:function w(){var D=Math.trunc(parseInt(v._dtSettings.oScroller.s.baseRowTop));return D!==0?D:false}},colorder:{key:"c",event:"column-reorder.dt",isInit:function y(){return typeof v._dtSettings._colReorder!=="undefined"},onLoad:function A(G){var F=G.split("."),D=[];$.each(F,function(L,K){if(K.indexOf("-")!==-1){var M=K.split("-"),I=parseInt(M[0]),H=parseInt(M[1]);if(I>H){for(var J=I;H<J+1;J--){D.push(J)}}else{for(var J=I;H>J-1;J++){D.push(J)}}}else{D.push(K)}});var E=D.map(function(H){return parseInt(H)});if(typeof v._dtApi.colReorder==="undefined"){return false}if(JSON.stringify(E)!==JSON.stringify(v._dtApi.colReorder.order())){v._dtApi.colReorder.order(E,true);v._shouldDraw=true}},isset:function z(){if(typeof v._dtApi.colReorder==="undefined"){return false}return JSON.stringify(v._dtApi.colReorder.order())!==JSON.stringify(v._dtApi.columns().indexes().toArray())},newHashVal:function w(){var I=v._dtApi.colReorder.order(),F=undefined,D=[],H=[],G=function G(J){return H[H.length-J]},E=function E(){var J=undefined;if(H.length===2){J=H[0]+"."+H[1]}else{J=H[0]+"-"+G(1)}H=[];return J};$.each(I,function(J,K){K=parseInt(K);if(typeof F==="undefined"){D.push(K)}else{if(H.length>0){if(G(1)>G(2)&&K===G(1)+1){H.push(K)}else{if(G(1)<G(2)&&K===G(1)-1){H.push(K)}else{D.push(E());D.push(K)}}}else{if(K===F+1||K===F-1){D.splice(D.length-1,1);H.push(F);H.push(K)}else{D.push(K)}}}F=K});if(H.length>0){D.push(E())}return D.join(".")}},order:{key:"o",event:"order.dt",isInit:function y(){var D=false;$.each(x._dtSettings.aoColumns,function(F,E){if(E.bSortable===true){D=true;return false}});return D},onLoad:function A(E){if(typeof E!=="undefined"){var D={a:"asc",d:"desc"};v._dtApi.order([parseInt(E.substring(1)),D[E.charAt(0)]]);v._shouldDraw=true}},isset:function z(){return v._dtApi.order()[0]&&JSON.stringify(v._dtApi.order())!==JSON.stringify($.fn.dataTable.defaults.aaSorting)},newHashVal:function w(){return v._dtApi.order()[0][1].charAt(0)+v._dtApi.order()[0][0]}}};if(typeof u==="string"){if(typeof B[u]==="undefined"){return false}return B[u]}else{if($.isArray(u)&&u.length>0){var C={};$.each(u,function(D,E){if(typeof B[E]==="undefined"){throw new Error("Unable to retrieve condition by name: "+E)}C[E]=B[E]});return C}}return B}}],[{key:"queryString",value:function f(){var y={},v=window.location.hash.substring(1),w=v.split("&");for(var u=0;u<w.length;u++){var x=w[u].split("=");if(typeof y[x[0]]==="undefined"){y[x[0]]=x[1]}else{if(typeof y[x[0]]==="string"){y[x[0]]=[y[x[0]],x[1]]}else{y[x[0]].push(x[1])}}}return y||false}},{key:"structureHash",value:function n(E,u){var x;if(!E){throw new Error("Illegal execution of KeepConditions.structureHash()")}if(E instanceof e){x=E.dtSettings()}else{if(typeof E.type!=="undefined"&&typeof E.data.dtSettings!=="undefined"){x=E.data.dtSettings}else{if(E instanceof $.fn.dataTable.Api){x=E.settings()[0]}else{if($.fn.DataTable.isDataTable(E)){x=new $.fn.dataTable.Api(E).settings()[0]}else{if($.isPlainObject(E)&&_typeof($.isPlainObject(E.oKeepConditions))){x=E}else{throw new Error("Unable to determine what you passed to KeepConditions.structureHash(), should be either an instance of KeepConditions, a proper jQuery event, or a DataTable instance with keepConditions enabled")}}}}}var B=new $.fn.dataTable.Api(x),v=x.oInit,D=x.oKeepConditions.getEnabledConditions(),y=e.queryString(),A=$(B.table().node()).attr("id"),z={},w=[],C=[];if(typeof D==="undefined"||D===false){throw new Error("Couldn't get conditions from table settings")}$.each(y,function(H,G){if(!H&&!G){return}if(H!==A){z[H]=G||""}});$.each(D,function(H,I){if(x.oKeepConditions.conditions()[I].isset()){var G=x.oKeepConditions.conditions()[I].newHashVal();if(typeof G!=="undefined"&&G!==false){w.push(x.oKeepConditions.conditions()[I].key+G)}}});z[A]=w.join(":");$.each(z,function(G,H){if(H.length>0){C.push(G+"="+H)}});var F=C.join("&");if(u===true){return F}window.location.hash=F||"_"}}]);return e})();(function(b,a,d,e){d.extend(true,d.fn.dataTable.defaults,{language:{keepConditions:{button:{btnCopyTitle:"URL Copied",btnCopyBody:"The URL with the DataTables conditions has been copied to your clipboard",btnSelectTitle:"Copy URL",btnSelectBody:"Copy be below input to easily share the URL"}}}});d(a).on("init.dt",function(g,f){if(g.namespace!=="dt"){return}if(f.oInit.keepConditions!==e){new KeepConditions(f)}});d.fn.dataTable.Api.register("keepConditions.attachEvents()",function(f){return this.iterator("table",function(g){return g.oKeepConditions.attachEvents()})});d.fn.dataTable.Api.register("keepConditions.detachEvents()",function(f){return this.iterator("table",function(g){return g.oKeepConditions.detachEvents()})});d.fn.dataTable.Api.register("keepConditions.structureHash()",function(f){return this.context[0].oKeepConditions.structureHash(f)});d.fn.dataTable.Api.register("keepConditions.enableCondition()",function(g,f){return this.iterator("table",function(h){return h.oKeepConditions.enableCondition(g,f)})});d.fn.dataTable.Api.register("keepConditions.disableCondition()",function(g,f){return this.iterator("table",function(h){return h.oKeepConditions.disableCondition(g,f)})});d.fn.dataTable.ext.buttons.copyConditions={text:"Copy Conditions",action:function c(m,f,h,g){var k=f.settings()[0].oLanguage.keepConditions,n=f.settings()[0].oKeepConditions.structureHash(true),j=a.location.protocol+"//"+a.location.host+(a.location.port.length?":"+a.location.port:"")+a.location.pathname+"#"+n,o,l={btnNoHashTitle:k.btnNoHashTitle||"No Conditions",btnNoHashBody:k.btnNoHashBody||"Thre are no conditions to be copied",btnCopyTitle:k.btnCopyTitle||"URL Copied",btnCopyBody:k.btnCopyBody||"The URL with the DataTables conditions has been copied to your clipboard",btnSelectTitle:k.btnSelectTitle||"Copy URL",btnSelectBody:k.btnSelectBody||"Copy be below input to easily share the URL"};if(!n){f.buttons.info(l.btnNoHashTitle,l.btnNoHashBody,3000);return}d("<input />").val(j).attr("id","copyConditions-text").css({position:"absolute",left:"-9999px",top:(b.pageYOffset||a.documentElement.scrollTop)+"px"}).appendTo("body");d("#copyConditions-text").select();try{a.execCommand("copy");f.buttons.info(l.btnCopyTitle,l.btnCopyBody,g.copyTimeout||4000);o=true}catch(i){f.buttons.info(l.btnSelectTitle,l.btnSelectBody+'<br><input id="keepConditions-input" value="'+j+'" style="width:90%;">',g.selectTimeout||10000);d("input#keepConditions-input").select()}finally{d("#copyConditions-text").remove()}}}})(window,document,jQuery);